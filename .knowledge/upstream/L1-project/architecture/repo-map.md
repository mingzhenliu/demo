- # WeDAP 仓库地图

  ## 概述

  WeDAP 是屏蔽 Web2 银行与 Web3 银行差异的标准化适配层。系统采用非侵入式架构设计，通过 API Gateway 和资产映射引擎，将复杂的链上交互封装为银行标准接口，让传统银行能快速上线加密资产服务。

  **核心设计理念：** 将 Web3 业务降维成类"外币账户管理"逻辑，确保银行在复用现有账户体系、风控流程和清算网络的前提下，实现对数字资产的统一账本管理。

  ## 仓库清单

  | 仓库名称        | 类型     | 描述                            | 主要技术 | 维护团队 |
  | --------------- | -------- | ------------------------------- | -------- | -------- |
  | wedap-gateway   | 后端服务 | API网关，支持Web2和Web3双向访问 | -        | -        |
  | wedap-adapter   | 后端服务 | 适配器层，提供统一服务和路由    | -        | -        |
  | wedap-web2-core | 后端服务 | Web2核心业务系统                | -        | -        |
  | wedap-counter   | 全栈应用 | 银行柜面系统（前后端）          | -        | -        |

  ## 仓库分类

  ### 后端服务仓库

  | 仓库            | 服务                        | 语言 | 框架 |
  | --------------- | --------------------------- | ---- | ---- |
  | wedap-gateway   | API Gateway / APP Gateway   | -    | -    |
  | wedap-adapter   | 适配器 / 路由器 / Connector | -    | -    |
  | wedap-web2-core | 小总账 / 支付 / AML / 监管  | -    | -    |
  | wedap-counter   | 银行柜面后端                |      |      |
  
  
  
  ### 前端应用仓库
  
  | 仓库          | 应用         | 框架 | 部署位置 |
  | ------------- | ------------ | ---- | -------- |
  | wedap-counter | 银行柜面前端 | -    | -        |
  
  ### 公共库仓库
  
  | 仓库   | 类型 | 用途 | 使用方 |
  | ------ | ---- | ---- | ------ |
  | 待规划 | -    | -    | -      |
  
  ### 基础设施仓库
  
  | 仓库   | 类型 | 用途 |
  | ------ | ---- | ---- |
  | 待规划 | -    | -    |
  
  ## 仓库依赖关系
  
  ```
  ┌─────────────────────────────────────────────────────────────────────────────┐
  │                           WeDAP 仓库依赖图                                   │
  ├─────────────────────────────────────────────────────────────────────────────┤
  │                                                                             │
  │   ┌──────────────────┐                                                      │
  │   │   外部服务        │                                                      │
  │   │  (钱包/BitGo/    │                                                      │
  │   │   Circle等)      │                                                      │
  │   └────────┬─────────┘                                                      │
  │            │                                                                │
  │            ▼                                                                │
  │   ┌──────────────────┐      ┌──────────────────┐                           │
  │   │  wedap-gateway   │◄────►│   银行APP/H5     │                           │
  │   │  (API Gateway)   │      │   银行后台       │                           │
  │   └────────┬─────────┘      └──────────────────┘                           │
  │            │                                                                │
  │            ▼                                                                │
  │   ┌──────────────────┐                                                      │
  │   │  wedap-adapter   │                                                      │
  │   │  (适配器层)       │                                                      │
  │   └────────┬─────────┘                                                      │
  │            │                                                                │
  │     ┌──────┴──────┐                                                         │
  │     │             │                                                         │
  │     ▼             ▼                                                         │
  │ ┌──────────────┐ ┌──────────────┐                                          │
  │ │wedap-web2-   │ │wedap-counter │                                          │
  │ │   core       │ │  (柜面系统)   │                                          │
  │ │ (核心业务)    │ │              │                                          │
  │ └──────────────┘ └──────────────┘                                          │
  │                                                                             │
  └─────────────────────────────────────────────────────────────────────────────┘
  ```
  
  **依赖说明：**
  
  - `wedap-gateway` 依赖 `wedap-adapter` 和 `wedap-web2-core`
  - `wedap-adapter` 通过 Connector 机制对接各银行系统和 `wedap-counter`
  - `wedap-counter` 独立部署，提供离线对接版本的运营能力
  
  ## 仓库详细说明
  
  ### wedap-gateway
  
  **定位：** 系统统一入口，双向网关
  
  | 模块        | 功能描述                                                     |
  | ----------- | ------------------------------------------------------------ |
  | API Gateway | 提供 Web2 银行和 Web3 银行后台双向访问，统一处理鉴权、限流、路由、报文协议转换 |
  | APP Gateway | 为 Web3 H5 提供统一流量入口，提供鉴权、限流、灰度、防篡改与重放；与 Web2 银行打通登录态 |
  
  ### wedap-adapter
  
  **定位：** 适配层，屏蔽银行差异
  
  | 模块              | 功能描述                                                     |
  | ----------------- | ------------------------------------------------------------ |
  | Web 2.0 适配器    | 提供标准接口，对 Web3 屏蔽传统银行接口差异，支持标准服务和 connector 路由配置 |
  | 内部路由器        | 根据 bankId 及配置选择对应 Connector                         |
  | Web 3.0 Connector | 标准 Connector，默认透传；支持差异化定制                     |
  | Web 2.0 Connector | 屏蔽 Web2 差异，包含：核心 Connector、Oracle 总账、SAP 总账、Swift、Sepa、AML 等插件 |
  
  ### wedap-web2-core
  
  **定位：** Web2 核心业务能力中心
  
  | 模块             | 功能描述                                                     |
  | ---------------- | ------------------------------------------------------------ |
  | 小总账           | 会计流水数据加工：数据标准化、客户信息映射、多币种换汇、格式转换对接银行大总账 |
  | 支付管理         | 屏蔽支付渠道差异（统一报文协议适配），封装支付路由策略（费用/时效），选择支付渠道 |
  | 客户钱包地址管理 | 本人交易合法性校验，管理银行客户与钱包地址映射关系           |
  | 资本管理         | 对接银行 RWA 和减值系统，提供原始交易数据和加工数据          |
  | 监管报送         | 数据标准化、客户信息映射、多币种换汇、格式转换对接银行监管报送系统 |
  | AML              | 数据处理对接银行反洗钱系统                                   |
  | 参数配置         | 业务模块参数、接入渠道系统、租户信息、账簿管理等基础配置     |
  | 流水对账         | 交易流水与银行或 Web3 对账，保持状态一致                     |
  | 对账文件         | 提供对账文件给银行或 Web3 使用                               |
  
  ### wedap-counter
  
  **定位：** 银行运营柜面（含前后端）
  
  | 模块              | 功能描述                                                     |
  | ----------------- | ------------------------------------------------------------ |
  | 工单审批          | 通用工单处理和审批，支持钱包、贷款等模块异步记账转工单；交易类型含开户、转账、手续费、冲正等 |
  | 预约工单          | 大额交易预约，运营审批后银行准备流动性，到期客户确认后操作   |
  | 客户信息管理      | 银行批量上传客户 ID、姓名、证件号、KYC、证件影像、他行卡列表等 |
  | 小总账 & 资本管理 | 查询和下载会计流水和资本管理数据                             |
  | 监管 & 反洗钱     | 查询和下载监管报送和反洗钱数据                               |
  | 参数管理          | 银行运营配置参数（如大额交易预约限额）                       |
  
  ## 仓库命名规范
  
  - 后端服务: `wedap-{module}`
  - 前端应用: `wedap-{module}-web`（如需独立）
  - 公共库: `wedap-common-{type}`
  - Connector: `wedap-connector-{bank/system}`
  
  ## 核心业务流程涉及仓库
  
  | 业务场景      | 涉及仓库                      | 外部系统                      |
  | ------------- | ----------------------------- | ----------------------------- |
  | 钱包开户      | gateway → adapter → counter   | 银行APP、钱包、BitGo          |
  | 稳定币申购    | gateway → adapter → counter   | 钱包、Circle                  |
  | 钱包提现      | gateway → adapter → web2-core | 钱包、BitGo、Circle、银行后台 |
  | APP登录态打通 | gateway                       | 银行APP、银行后台             |
  
  ## 设计原则
  
  1. **标准化接口**：提供银行友好标准化 API，屏蔽 Web3 复杂性
  2. **架构解耦**：对传统银行屏蔽 Web3 底层技术，对 Web3 屏蔽各银行差异
  3. **可插拔**：插件化架构，银行可选模块（托管钱包、质押贷款、理财、RWA、存款代币化）
  4. **合规适配**：Web3 业务与传统银行会计核算统一管理，支持表内/表外资产独立核算
  
  ## L2 知识库引用
  
  各仓库应通过 Git Subtree 引用本 L1 知识库：
  
  ```bash
  # 在 L2 仓库中执行
  git remote add L1-knowledge git@github.com:org/wedap-knowledge.git
  git subtree add --prefix=.knowledge/upstream/L1-project L1-knowledge main --squash
  ```
  
  ## 维护说明
  
  - 新建仓库需更新本文档
  - 仓库归档/删除需提前通知
  - 仓库迁移需同步更新所有引用
  - Connector 新增需在 wedap-adapter 仓库中注册
