- # WeDAP 业务知识入口

  ## 业务定位

  WeDAP 是屏蔽 Web2 银行与 Web3 银行差异的标准化适配层，将 Web3 业务降维成类"外币账户管理"逻辑，让传统银行在复用现有账户体系、风控流程和清算网络的前提下，实现对数字资产的统一账本管理。

  ## 业务领域全景

  ```
  ┌─────────────────────────────────────────────────────────────────────────┐
  │                         WeDAP 业务领域                                   │
  ├─────────────────────────────────────────────────────────────────────────┤
  │                                                                          │
  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
  │  │   接入认证   │  │   支付清算   │  │   会计核算   │  │   合规报送   │    │
  │  │  (Access)   │  │  (Payment)  │  │ (Accounting)│  │(Compliance) │    │
  │  │ 登录态/鉴权 │  │  路由/通道  │  │  小总账     │  │  监管/AML   │    │
  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
  │                                                                          │
  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
  │  │   钱包管理   │  │   工单处理   │  │   客户管理   │  │   参数配置   │    │
  │  │  (Wallet)   │  │  (Workflow) │  │ (Customer)  │  │  (Config)   │    │
  │  │ 地址/映射   │  │  审批/预约  │  │  KYC/信息   │  │  策略/限额  │    │
  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
  │                                                                          │
  │  ┌─────────────────────────────────────────────────────────────────┐   │
  │  │                        对账reconciliation)                       │   │
  │  │              流水对账 | 状态同步 | 对账文件 | 差异处理             │   │
  │  └─────────────────────────────────────────────────────────────────┘   │
  │                                                                          │
  └─────────────────────────────────────────────────────────────────────────┘
  ```

  ---

  ## 核心业务领域

  ### 1. 接入认证 (Access)

  银行APP与Web3 H5的统一身份认证和登录态管理。

  | 项目         | 说明                                                  |
  | ------------ | ----------------------------------------------------- |
  | **核心流程** | 银行登录 → Token签发 → H5跳转 → 登录态兑换 → 会话建立 |
  | **关键能力** | JWT认证、PKCE校验、防重放攻击、登录态打通             |
  | **安全机制** | 30秒Token时效、JTI唯一性校验、SHA256 Challenge验证    |

  **业务规则：**

  - Token有效期30秒，过期需重新申请
  - JTI(JWT ID)全局唯一，防止重放攻击
  - PKCE Verifier与Challenge必须匹配

  ---

  ### 2. 支付清算 (Payment)

  屏蔽支付渠道差异，提供统一的支付路由和清算能力。

  | 项目         | 说明                                                 |
  | ------------ | ---------------------------------------------------- |
  | **核心流程** | 支付发起 → 渠道选择 → 报文转换 → 交易执行 → 结果回调 |
  | **关键能力** | 支付路由策略、报文协议适配、多渠道管理               |
  | **支付通道** | SWIFT、SEPA、银行核心、Circle                        |

  **业务规则：**

  - 根据费用、时效等因素自动选择最优支付渠道
  - 统一报文协议适配，屏蔽各渠道差异
  - 大额交易需预约审批

  ---

  ### 3. 会计核算 (Accounting)

  加工会计流水数据，对接银行大总账系统。

  | 项目         | 说明                                                   |
  | ------------ | ------------------------------------------------------ |
  | **核心流程** | 交易发生 → 数据采集 → 标准化加工 → 格式转换 → 总账对接 |
  | **关键能力** | 数据标准化、客户信息映射、多币种换汇、格式转换         |
  | **对接系统** | 银行大总账、Oracle总账、SAP总账                        |

  **业务规则：**

  - 所有交易流水需标准化处理后入账
  - 支持多币种自动换汇
  - 支持表内/表外资产独立核算

  ---

  ### 4. 合规报送 (Compliance)

  满足监管要求的数据报送和反洗钱筛查。

  | 项目         | 说明                                                 |
  | ------------ | ---------------------------------------------------- |
  | **核心流程** | 数据采集 → 规则筛查 → 数据加工 → 报送生成 → 系统对接 |
  | **关键能力** | 监管报送、AML反洗钱、数据标准化                      |
  | **报送类型** | 监管报表、反洗钱报告、可疑交易报告(SAR)              |

  **业务规则：**

  - 所有交易需经过AML规则筛查
  - 监管数据需按规定格式和周期报送
  - 可疑交易需及时上报

  ---

  ### 5. 钱包管理 (Wallet)

  银行客户与钱包地址的映射关系管理。

  | 项目         | 说明                                      |
  | ------------ | ----------------------------------------- |
  | **核心流程** | 钱包开户 → 地址绑定 → 映射存储 → 交易校验 |
  | **关键能力** | 地址映射、本人校验、托管钱包创建          |
  | **外部服务** | BitGo托管、Circle稳定币                   |

  **业务规则：**

  - 钱包地址必须与银行客户一一映射
  - 交易前需校验钱包地址属于当前登录客户
  - 钱包开户需完成银行KYC验证

  ---

  ### 6. 工单处理 (Workflow)

  异步交易的工单审批和预约管理。

  | 项目         | 说明                                               |
  | ------------ | -------------------------------------------------- |
  | **核心流程** | 工单创建 → 待处理 → 柜员操作 → 审批完成 → 通知回调 |
  | **关键能力** | 通用工单审批、预约工单、异步记账                   |
  | **工单类型** | 开户、转账、手续费、交易冲正                       |

  **业务规则：**

  - 异步交易自动转工单处理
  - 大额交易需提前预约，银行准备流动性
  - 工单完成后自动通知Web3系统

  **预约工单流程：**

  1. 客户提交大额预约申请
  2. 银行运营人员审批预约单
  3. 银行内部准备流动性资金
  4. 到期后客户确认实际需求
  5. 运营人员按实际需求操作

  ---

  ### 7. 客户管理 (Customer)

  银行客户信息和KYC资料管理。

  | 项目         | 说明                                                |
  | ------------ | --------------------------------------------------- |
  | **核心流程** | 资料上传 → 信息验证 → 数据存储 → 查询服务           |
  | **关键能力** | 批量上传、覆盖更新、KYC查询                         |
  | **客户信息** | 客户ID、姓名、证件号、KYC等级、证件影像、他行卡列表 |

  **业务规则：**

  - 客户KYC资料需提前上传
  - 支持批量导入和增量更新
  - Web3开户时自动查询KYC数据

  ---

  ### 8. 参数配置 (Config)

  业务经营策略和系统参数管理。

  | 项目         | 说明                                           |
  | ------------ | ---------------------------------------------- |
  | **核心流程** | 参数定义 → 配置录入 → 生效发布 → 运行时读取    |
  | **关键能力** | 业务策略配置、渠道配置、租户管理、账簿管理     |
  | **配置类型** | 大额交易限额、支付路由策略、接入渠道、租户信息 |

  **业务规则：**

  - 参数变更需审批后生效
  - 支持多租户独立配置
  - 限额参数实时生效

  ---

  ### 9. 对账 (Reconciliation)

  交易流水与银行或Web3系统的对账管理。

  | 项目         | 说明                                                 |
  | ------------ | ---------------------------------------------------- |
  | **核心流程** | 流水采集 → 数据比对 → 差异识别 → 差异处理 → 状态同步 |
  | **关键能力** | 流水对账、状态同步、对账文件生成                     |
  | **对账对象** | 银行核心系统、Web3钱包系统                           |

  **业务规则：**

  - 交易状态需与银行和Web3保持一致
  - 定期生成对账文件供各方使用
  - 差异需人工介入处理

  ---

  ## 跨领域业务流程

  ### 钱包开户流程

  ```
  客户 → 银行开户 → KYC资料上传 → Web3申请 → KYC验证 → 托管钱包创建 → 开户完成
   │         │            │           │          │            │           │
  发起申请  银行KYC     柜员上传    H5发起    查询KYC     BitGo创建   返回地址
  ```

  **关键步骤：**

  1. 客户在银行APP完成开户和KYC验证
  2. 银行柜员提前上传客户KYC资料到WeDAP
  3. 客户在Web3 H5发起钱包开户
  4. 系统查询并验证客户KYC数据
  5. 调用BitGo创建托管钱包
  6. 返回钱包地址，建立客户-地址映射

  ### 稳定币申购流程（入金）

  ```
  客户 → 充值申请 → 创建工单 → 银行扣款 → 柜员记账 → 工单完成 → Circle到账 → 余额更新
   │         │          │          │          │          │           │          │
  发起申请  生成工单   等待处理   账户扣款   转账Circle  通知Web3   资金确认   充值成功
  ```

  **关键步骤：**

  1. 客户在H5发起充值申请
  2. 系统创建扣款工单，返回处理中状态
  3. 银行运营人员在柜面执行转账到Circle
  4. 扣除手续费，完成工单
  5. 通知Web3记账完成
  6. Circle资金到账后双重确认
  7. 更新用户稳定币余额

  ### 提现流程（出金）

  ```
  客户 → 提现申请 → 数字货币兑换 → 稳定币赎回 → 银行入账 → 提现完成
   │         │           │            │           │          │
  发起申请  创建工单   BitGo转换   Circle赎回   账户入账   通知客户
  ```

  **关键步骤：**

  1. 客户查询钱包余额和银行账户列表
  2. 发起提现申请，选择目标银行账户
  3. 数字货币通过BitGo兑换为稳定币
  4. 稳定币通过Circle赎回为法币
  5. 法币转入客户银行账户
  6. 通知客户提现成功

  ### APP登录态打通流程

  ```
  客户 → 点击Web3入口 → PKCE生成 → 申请JWT → H5加载 → Token兑换 → 会话建立
   │          │            │          │         │          │          │
  银行APP   准备跳转    生成暗号   签发令牌  JSBridge   安全校验   登录成功
  ```

  **安全校验要点：**

  1. JWT签名验证（银行公钥）
  2. 时效验证（30秒有效期）
  3. 防重放验证（JTI唯一性）
  4. PKCE验证（Challenge匹配）

  ---

  ## 术语词典

  | 术语          | 说明                                           |
  | ------------- | ---------------------------------------------- |
  | **小总账**    | WeDAP内部的会计账本，加工后对接银行大总账      |
  | **工单**      | 异步交易的处理单据，需柜员人工处理             |
  | **Connector** | 适配不同银行或系统的连接器插件                 |
  | **PKCE**      | Proof Key for Code Exchange，OAuth安全扩展协议 |
  | **JTI**       | JWT ID，JWT的唯一标识符                        |
  | **Circle**    | 稳定币发行商，提供USDC等稳定币服务             |
  | **BitGo**     | 数字资产托管服务商                             |
  | **KYC**       | Know Your Customer，客户身份识别               |
  | **AML**       | Anti-Money Laundering，反洗钱                  |
  | **SAR**       | Suspicious Activity Report，可疑活动报告       |

  ---

  ## 领域事件全景

  | 领域     | 关键事件                                    | 影响范围           |
  | -------- | ------------------------------------------- | ------------------ |
  | 接入认证 | TokenIssued, SessionCreated                 | 会话管理、审计日志 |
  | 支付清算 | PaymentInitiated, PaymentCompleted          | 会计、对账、通知   |
  | 会计核算 | LedgerEntryCreated, ReconciliationCompleted | 总账对接、报表     |
  | 合规报送 | AMLScreeningCompleted, ReportSubmitted      | 监管系统、审计     |
  | 钱包管理 | WalletCreated, AddressMapped                | 客户管理、交易校验 |
  | 工单处理 | WorkOrderCreated, WorkOrderApproved         | 柜面、Web3通知     |
  | 客户管理 | CustomerInfoUploaded, KYCVerified           | 钱包开户、合规     |
  | 对账     | ReconciliationStarted, DifferenceFound      | 差异处理、状态同步 |

  ---

  ## 业务约束与规则

  ### 安全约束

  | 规则         | 说明                         |
  | ------------ | ---------------------------- |
  | 本人交易校验 | 钱包地址必须属于当前登录客户 |
  | Token时效    | 登录态Token有效期30秒        |
  | 防重放       | JTI在60秒内不可重复使用      |
  | 签名验证     | 所有JWT需使用银行公钥验证    |

  ### 业务约束

  | 规则       | 说明                               |
  | ---------- | ---------------------------------- |
  | KYC前置    | 钱包开户前必须完成银行KYC          |
  | 大额预约   | 大额交易需提前预约审批             |
  | 对账一致性 | 交易状态需与银行和Web3保持一致     |
  | 工单闭环   | 所有工单必须完成处理后才能通知Web3 |

  ---

  ## 快速导航

  - [代码仓库](./代码仓库.md) - 系统仓库清单与交互时序图
  - [术语词典](./business/glossary.md) - 标准化术语定义
  - [业务流程](./business/workflows/) - 核心业务流程文档

  ## 相关链接

  - [Web3金融业务知识](./BUSINESS.md) - Web3金融服务平台业务全景
  - [架构知识入口](./ARCHITECTURE.md) - 技术架构文档
  - [项目规范](./standards/) - 开发规范与标准